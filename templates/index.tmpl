<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <title>Njuhalo results</title>  
        <style>
            li {
                display: block;
            }
            .hidden { display: none;}
            #search {
                top: 0;
                left: 0;
                width: 100%;
                height: 30px;
                position: sticky;
                font-size: 20px;
            }
            .search-list {
                margin-top: 60px;
            }
            .new {
                background-color: #f44336;
            }
        </style>      
    </head>
    <body>
        <form method="POST" action="/save-query">
            <input id="query" type="text" placeholder="Add new query" name="query"/>
            <br>
            <label for="interval">monitor for this query every:</label>
            <input id="interval" type="number" min="1" placeholder="(min)" name="interval"/>
            <input type="submit" value="Add query">
        </form>
        <form method="POST" action="/fetch-results">
            <input type="submit" value="Fetch results">
        </form>
        <h2>Queries</h2>
        <span><a href="/" >Novi |</a></span>
        {{range .Queries}}
            <span>
                <a href="?offerId={{.ID}}" >{{.Name}} <span>({{.MonitoringInterval}} min)</span></a>
                <form method="POST" action="/delete-query">
                    <input type="hidden" value="{{.ID}}" name="queryId"/>
                    <input type="submit" value="Delete">            
                </form>
            </span>
        {{end}}
        <hr>
        <input id="search" type="text" placeholder="Type to filter..." autofocus/>
        <p>Total: {{ len .Offers }}</p>
        <ul class="search-list">
            {{range .Offers}}
            <li {{ if eq .IsNew 1}}class="new"{{ end }}>
                <a href="{{.URL}}" target="_blank">{{.Name}}</a>
                </br>
                <a href="{{.URL}}" target="_blank"><img src="{{.Image}}"></a>
                <p><b>{{.Price}}</b>&nbsp;{{.Description}}</p> 
                <p>Lokacija: {{.Location}}</p>
                <p>Kilometra≈æa: {{.Mileage}}km</p>
                <p>Godina: {{.Year}}</p>
                <p>{{.Published}}</p>
                <span>Analiziran: {{ ts2date .CreatedAt }}</span>
                <hr>
            </li>
            {{end}}
        </ul>
    </body>
    <script>
    var input = document.querySelector('#search');
    var items = document.querySelector('.search-list').getElementsByTagName('li');
    input.addEventListener('keyup', function(ev) {
        var text = ev.target.value
        var pat = new RegExp(text, 'i')
        for (var i=0; i < items.length; i++) {
            var item = items[i]
            if (pat.test(item.innerText)) {
                item.className = item.className.replace('hidden','');;
                continue
            }

            item.className = item.className + ' hidden';
        }
    });
    </script>
</html>